generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  id          Int    @id @default(autoincrement())
  email       String @unique
  firstName   String
  lastName    String
  password    String
  description String
  phoneNumber String @unique
  address     String
  role        Role
}

enum Role {
  SuperAdmin
  Agent
  Responsable_Stock
}

//F4801T  entete Ordre de fabrication 
//fk id workorder
model HeaderWO {
  numOF      Int       @id
  workOrder  WorkOrder @relation(fields: [numOF], references: [DOCO])
  costMethod String
}

//is documentType is a unique field in 4801??
//F4801 Ordre de fabrication  remember that the document type is the same in the F4111 and F3111
model WorkOrder {
  DOCO                        Int                  @id @default(autoincrement())
  quantityOrdered             Int
  startDate                   DateTime
  requestedDate               DateTime
  workOrderDate               DateTime
  quantityShipped             Int                  @default(0)
  quantityCanceled            Int                  @default(0)
  unaccountedDirectLaborHours Int                  @default(0)
  documentType                String
  statusChangeDate            DateTime
  statusCode                  String
  completionDate              DateTime
  updatedDate                 DateTime             @updatedAt
  HeaderWO                    HeaderWO?
  WorkOrderRouting            WorkOrderRouting[]
  WorkOrderPartsList          WorkOrderPartsList[]
  TransationHistory           TransationHistory[]
}

//F3112 gamme de fabrication
model WorkOrderRouting {
  numOF                    Int
  workOrder                WorkOrder @relation(fields: [numOF], references: [DOCO])
  sequenceNumberOperations String
  businessUnit             String
  typeOperationCode        String
  runLabour                Int
  runMachine               Int
  setupLabor               Int

  @@id([numOF, sequenceNumberOperations, businessUnit, typeOperationCode])
}

//f3003  gamme standard 

//ALL ABOVE IS DONE !!

//F3111 nomenclature            remember that the document type is the same in the F4111 and F4801

model WorkOrderPartsList {
  numOF                        Int
  workOrder                    WorkOrder          @relation(fields: [numOF], references: [DOCO])
  LITM                         String             @unique //CPIT
  UKID                         Int                @default(autoincrement())
  quantityOrdered              Int
  issuedQuantity               Int
  unaccountedDirectLaborHours  Int
  unaccountedDirectLaborAmount Int
  updatedDate                  DateTime           @updatedAt
  quantityCanceled             Int                @default(0)
  documentType                 String
  TransationHistory            TransationHistory?

  @@id([LITM, UKID])
}

//remember that the document type is the same in the F4801 and F3111
//fk ITM
//f4111
model TransationHistory {
  numOF                   Int
  UKID                    Int                @id @default(autoincrement())
  codeArticle             String             @unique
  orderAndTransactionDate DateTime
  recordCreationDate      DateTime           @default(now())
  //postedCode              String    //sert a rien 
  documentType            String //IC Produit fini    //WO Input  from of articles  noemnclature 
  ItemLocation            ItemLocation?
  WorkOrderPartsList      WorkOrderPartsList @relation(fields: [codeArticle], references: [LITM])
  workOrder               WorkOrder          @relation(fields: [numOF], references: [DOCO])
}

//f41021       1..1 relations between 4111 and 41021 change it in conception
model ItemLocation {
  codeArticle       String            @id
  FK_CodeArticle    TransationHistory @relation(fields: [codeArticle], references: [codeArticle])
  lotStatusCode     String
  quantityOnHand    Int
  quantityReserved  Int
  quantityAvailable Int //QAVAL

  @@unique([codeArticle])
}

model Log {
  id         Int      @id @default(autoincrement())
  action     String
  entity     String //as workorder ,stock,article ...
  entityId   Int?
  userId     Int?
  timestamp  DateTime @default(now())
  method     String?
  url        String?
  statusCode Int? // as 404 or 200 ...
}
